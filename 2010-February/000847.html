<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> High CPU load with USB sound device
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/fldigi-alpha/2010-February/index.html" >
   <LINK REL="made" HREF="mailto:fldigi-alpha%40lists.berlios.de?Subject=Re%3A%20High%20CPU%20load%20with%20USB%20sound%20device&In-Reply-To=%3C4B77E86F.8030601%40penjarvis.co.uk%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000841.html">
   <LINK REL="Next"  HREF="000849.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>High CPU load with USB sound device</H1>
    <B>Peter Hamilton</B> 
    <A HREF="mailto:fldigi-alpha%40lists.berlios.de?Subject=Re%3A%20High%20CPU%20load%20with%20USB%20sound%20device&In-Reply-To=%3C4B77E86F.8030601%40penjarvis.co.uk%3E"
       TITLE="High CPU load with USB sound device">fldigi at penjarvis.co.uk
       </A><BR>
    <I>Sun Feb 14 13:11:27 CET 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="000841.html">High CPU load with USB sound device
</A></li>
        <LI>Next message: <A HREF="000849.html">High CPU load with USB sound device
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#847">[ date ]</a>
              <a href="thread.html#847">[ thread ]</a>
              <a href="subject.html#847">[ subject ]</a>
              <a href="author.html#847">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
&gt;<i> Linux audio does seem to be a can of worms
</I>
The worms are still wriggling....


To recap, I had very high processor load from the second fldigi when
running two instances of fldigi using PortAudio.  The high-load instance
was using a USB audio card. That problem appears to be fixed by using
OSS instead of portaudio. This is with Xubuntu V9.10, which does not
include pulseaudio and uses Xfce instead of Gnome. Now read on:


After using the dual-fldigi setup for a while without problems,
including a reboot to make sure everything initialised properly, the CPU
load hit maximum, with top showing zero idle and the culprit being the
fldigi instance using the *internal* sound card. Although the symptom is
high CPU load like before, this appears to be a different problem: the
misbehaving fldigi was the one using the internal sound card, and the
CPU load wasn't just high, it was maximum (corresponding to an fldigi
CPU load around 80-85%).

If I killed the well-behaved fldigi instance, the load of the
misbehaving one just increased to maximum. If I restarted the
well-behaved fldigi it worked, BUT while it was running the misbehaving
fldigi got no audio - the waterfall disappeared. Kill the well-behaved
fldigi and the waterfall reappeared.

Eventually I discovered that this is more likely to happen when the PC
is rebooted with the USB sound card installed - I haven't yet seen it
when the USB device is plugged in after a reboot, which is why this
wasn't noticed earlier.


The Solution:

This was with both fldigi instances having &quot;manage mixer&quot; ticked. The
above problem goes away completely if neither fldigi instance touches
the mixer. The problem is linked to fldigi's state on startup: If
&quot;manage mixer&quot; is enabled in the preferences file the CPU load hits the
roof *and stays there* for the session even if &quot;manage mixer&quot; is then
disabled. If it's disabled on startup, fldigi behaves itself for that
session even if &quot;manage mixer&quot; is enabled during the session. This is
100% repeatable.

So the fix is to disable mixer control: since doing that I have had no
problems whatsoever.


My workaround, which I actually prefer to fiddling with a continuous
mixer control, is to create a few macros to select different power
levels. They look like:

&lt;EXEC&gt;alsactl -f ~/fldigi/icom706-10W.alsa restore&lt;/EXEC&gt;

Where the files *.alsa are generated by adjusting the mixer values with
alsamixer for the right levels and then saving with

alsactl -f &lt;filename&gt; store

(Is it worth adding similar functionality within fldigi? A row of macro
buttons which instantly select previously calibrated power levels is
quite useful.)


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000841.html">High CPU load with USB sound device
</A></li>
	<LI>Next message: <A HREF="000849.html">High CPU load with USB sound device
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#847">[ date ]</a>
              <a href="thread.html#847">[ thread ]</a>
              <a href="subject.html#847">[ subject ]</a>
              <a href="author.html#847">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/fldigi-alpha">More information about the fldigi-alpha
mailing list</a><br>
</body></html>
